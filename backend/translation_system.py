#!/usr/bin/env python3
"""
Unified Translation System for The Dying Lands
Handles all translation and localization functionality.
"""

from typing import Dict, Any, Optional, List

class TranslationSystem:
    """Unified translation system for The Dying Lands."""
    
    def __init__(self, language: str = 'en'):
        self.language = language
        self.translations = self._load_translations()
    
    def _load_translations(self) -> Dict[str, Dict[str, str]]:
        """Load all translation data."""
        return {
            'en': {
                # UI Elements
                'hex_prompt': 'Enter hex code (XXYY format, e.g., 0601) or range (0601-0610): ',
                'terrain_prompt': 'Terrain type for this hex (mountain/forest/coast/plains/swamp): ',
                'invalid_hex': 'Invalid hex format. Using default range.',
                'files_generated': 'Files generated in \'dying_lands_output/\' directory:',
                'hex_files': 'hex files in hexes/',
                'overland_hex_map': 'The Dying Lands Hex Map',
                'hex_descriptions': 'Hex Descriptions',
                
                # Content Types
                'terrain': 'Terrain',
                'encounter': 'Encounter',
                'denizen': 'Denizen',
                'location': 'Location',
                'notable_feature': 'Notable Feature',
                'atmosphere': 'Atmosphere',
                'motivation': 'Motivation',
                'demeanor': 'Demeanor',
                
                # Generation Messages
                'generating_full_map': 'Generating Full Map',
                'map_size': 'Map Size',
                'language': 'Language',
                'generation_complete': 'Generation Complete',
                'creating_ascii_map': 'Creating ASCII Map',
                'generating_hex': 'Generating hex',
                'skipping_existing': 'Skipping existing hex',
                
                # Error Messages
                'error_loading_hex': 'ERROR LOADING HEX',
                'error_loading_city': 'ERROR LOADING CITY DETAILS',
                'error_loading_settlement': 'ERROR LOADING SETTLEMENT DETAILS',
                'error_generating_hex': 'ERROR GENERATING HEX CONTENT',
                'error_generating_map': 'ERROR GENERATING FULL MAP',
                'error_resetting_continent': 'ERROR RESETTING CONTINENT',
                
                # Success Messages
                'generated_hexes': 'Generated {count} hexes!',
                'continent_reset': 'Continent reset! Generated {count} fresh hexes',
                'hex_generated': 'Generated content for hex {hex_code}',
                
                # Confirmation Messages
                'confirm_generate_all': 'GENERATE CONTENT FOR THE ENTIRE MAP? THIS MAY TAKE A WHILE...',
                'confirm_reset_continent': 'üö® RESET ENTIRE CONTINENT? üö®\n\nTHIS WILL DELETE ALL GENERATED CONTENT AND CREATE A COMPLETELY FRESH MAP.\n\nTHIS ACTION CANNOT BE UNDONE!',
                
                # Status Messages
                'generating_map': '‚è≥ Generating Map...',
                'resetting_generating': 'üîÑ Resetting & Generating...',
                'clearing_content': 'üóëÔ∏è Clearing old content and generating fresh map...',
                'generating_hex_content': '‚è≥ Generating hex content...',
                'resetting_continent': 'üîÑ Resetting continent...',
                
                # Map Elements
                'major_cities': 'MAJOR CITIES',
                'settlements': 'SETTLEMENTS',
                'terrain_legend': 'TERRAIN:',
                'locations_legend': 'LOCATIONS:',
                'has_content': 'BOLD = HAS CONTENT',
                
                # Modal Titles
                'hex_details': 'HEX DETAILS',
                'city_details': 'CITY DETAILS',
                'settlement_details': 'SETTLEMENT DETAILS',
                'terrain_overview': 'üó∫Ô∏è TERRAIN OVERVIEW',
                'lore_overview': 'üìú M√ñRK BORG LORE',
                
                # Button Labels
                'close': 'CLOSE',
                'generate_content': 'GENERATE CONTENT',
                'generate_all': '‚ö° GENERATE ALL',
                'reset_continent': 'ü©∏ RESET CONTINENT',
                'zoom_in': 'üîç+',
                'zoom_out': 'üîç-',
                'terrain_button': 'üó∫Ô∏è TERRAIN',
                'lore_button': 'üçÑ LORE',
                
                # Map Information
                'click_hexes': 'CLICK HEXES TO VIEW/GENERATE CONTENT',
                'major_city_symbol': '‚óÜ = MAJOR CITIES',
                'settlement_symbol': '‚åÇ = SETTLEMENTS',
                
                # Terrain Names
                'mountain': 'Mountain',
                'forest': 'Forest', 
                'coast': 'Coast',
                'plains': 'Plains',
                'swamp': 'Swamp',
                'desert': 'Desert',
                'unknown': 'Unknown',
                
                # NPC Field Labels
                'npc_trait': 'Trait',
                'npc_concern': 'Concern',
                'npc_want': 'Want',
                'npc_apocalypse_attitude': 'Apocalypse Attitude',
                'npc_secret': 'Secret',
                'npc_location': 'Location',
                'npc_carries': 'Carries',
                
                # Content Field Labels
                'territory': 'Territory',
                'threat_level': 'Threat Level',
                'treasure_found': 'Treasure Found',
                'loot_found': 'Loot Found',
                'type': 'Type',
                'item': 'Item',
                'description': 'Description',
                'full_description': 'Full Description',
                'name': 'Name',
                'behavior': 'Behavior',
                'feature': 'Feature',
                'danger': 'Danger',
                'atmosphere': 'Atmosphere',
                'motivation': 'Motivation',
                'demeanor': 'Demeanor',
                'origin': 'Origin',
                'weather': 'Weather',
                'innkeeper': 'Innkeeper',
                'effect': 'Effect',
                'builder': 'Builder',
                'age': 'Age',
                'population': 'Population',
                'trend': 'Trend',
                'government': 'Government',
                
                # Settlement Field Labels
                'local_tavern': 'Local Tavern',
                'local_power': 'Local Power',
                'city_event': 'City Event',
                'settlement_layout': 'Settlement Layout',
                'key_npcs': 'Key NPCs',
                
                # City Overlay Field Labels
                'district': 'District',
                'position': 'Position',
                'random_encounters': 'Random Encounters',
                'notable_features': 'Notable Features',
                'encounter': 'Encounter'
            },
            'pt': {
                # UI Elements
                'hex_prompt': 'Digite o c√≥digo do hex (formato XXYY, ex: 0601) ou intervalo (0601-0610): ',
                'terrain_prompt': 'Tipo de terreno para este hex (montanha/floresta/costa/planicie/pantano): ',
                'invalid_hex': 'Formato de hex inv√°lido. Usando intervalo padr√£o.',
                'files_generated': 'Arquivos gerados no diret√≥rio \'dying_lands_output/\':',
                'hex_files': 'arquivos de hex em hexes/',
                'overland_hex_map': 'Mapa Hexagonal das Terras Moribundas',
                'hex_descriptions': 'Descri√ß√µes dos Hex√°gonos',
                
                # Content Types
                'terrain': 'Terreno',
                'encounter': 'Encontro',
                'denizen': 'Habitante',
                'location': 'Localiza√ß√£o',
                'notable_feature': 'Caracter√≠stica Not√°vel',
                'atmosphere': 'Atmosfera',
                'motivation': 'Motiva√ß√£o',
                'demeanor': 'Comportamento',
                
                # Generation Messages
                'generating_full_map': 'Gerando Mapa Completo',
                'map_size': 'Tamanho do Mapa',
                'language': 'Idioma',
                'generation_complete': 'Gera√ß√£o Completa',
                'creating_ascii_map': 'Criando Mapa ASCII',
                'generating_hex': 'Gerando hex',
                'skipping_existing': 'Pulando hex existente',
                
                # Error Messages
                'error_loading_hex': 'ERRO AO CARREGAR HEX',
                'error_loading_city': 'ERRO AO CARREGAR DETALHES DA CIDADE',
                'error_loading_settlement': 'ERRO AO CARREGAR DETALHES DO ASSENTAMENTO',
                'error_generating_hex': 'ERRO AO GERAR CONTE√öDO DO HEX',
                'error_generating_map': 'ERRO AO GERAR MAPA COMPLETO',
                'error_resetting_continent': 'ERRO AO RESETAR CONTINENTE',
                
                # Success Messages
                'generated_hexes': 'Gerados {count} hexes!',
                'continent_reset': 'Continente resetado! Gerados {count} hexes frescos',
                'hex_generated': 'Conte√∫do gerado para hex {hex_code}',
                
                # Confirmation Messages
                'confirm_generate_all': 'GERAR CONTE√öDO PARA TODO O MAPA? ISSO PODE DEMORAR...',
                'confirm_reset_continent': 'üö® RESETAR CONTINENTE INTEIRO? üö®\n\nISSO IR√Å DELETAR TODO O CONTE√öDO GERADO E CRIAR UM MAPA COMPLETAMENTE NOVO.\n\nESTA A√á√ÉO N√ÉO PODE SER DESFEITA!',
                
                # Status Messages
                'generating_map': '‚è≥ Gerando Mapa...',
                'resetting_generating': 'üîÑ Resetando & Gerando...',
                'clearing_content': 'üóëÔ∏è Limpando conte√∫do antigo e gerando mapa fresco...',
                'generating_hex_content': '‚è≥ Gerando conte√∫do do hex...',
                'resetting_continent': 'üîÑ Resetando continente...',
                
                # Map Elements
                'major_cities': 'CIDADES PRINCIPAIS',
                'settlements': 'ASSENTAMENTOS',
                'terrain_legend': 'TERRENO:',
                'locations_legend': 'LOCALIZA√á√ïES:',
                'has_content': 'NEGRITO = TEM CONTE√öDO',
                
                # Modal Titles
                'hex_details': 'DETALHES DO HEX',
                'city_details': 'DETALHES DA CIDADE',
                'settlement_details': 'DETALHES DO ASSENTAMENTO',
                'terrain_overview': 'üó∫Ô∏è VIS√ÉO GERAL DO TERRENO',
                'lore_overview': 'üìú LORE DO M√ñRK BORG',
                
                # Button Labels
                'close': 'FECHAR',
                'generate_content': 'GERAR CONTE√öDO',
                'generate_all': '‚ö° GERAR TUDO',
                'reset_continent': 'ü©∏ RESETAR CONTINENTE',
                'zoom_in': 'üîç+',
                'zoom_out': 'üîç-',
                'terrain_button': 'üó∫Ô∏è TERRENO',
                'lore_button': 'üçÑ LORE',
                
                # Map Information
                'click_hexes': 'CLIQUE NOS HEXES PARA VER/GERAR CONTE√öDO',
                'major_city_symbol': '‚óÜ = CIDADES PRINCIPAIS',
                'settlement_symbol': '‚åÇ = ASSENTAMENTOS',
                
                # Terrain Names
                'mountain': 'Montanha',
                'forest': 'Floresta',
                'coast': 'Costa',
                'plains': 'Plan√≠cie',
                'swamp': 'P√¢ntano',
                'desert': 'Deserto',
                'unknown': 'Desconhecido',
                
                # NPC Field Labels
                'npc_trait': 'Caracter√≠stica',
                'npc_concern': 'Preocupa√ß√£o',
                'npc_want': 'Desejo',
                'npc_apocalypse_attitude': 'Atitude do Apocalipse',
                'npc_secret': 'Segredo',
                'npc_location': 'Localiza√ß√£o',
                'npc_carries': 'Carrega',
                
                # Content Field Labels
                'territory': 'Territ√≥rio',
                'threat_level': 'N√≠vel de Amea√ßa',
                'treasure_found': 'Tesouro Encontrado',
                'loot_found': 'Saque Encontrado',
                'type': 'Tipo',
                'item': 'Item',
                'description': 'Descri√ß√£o',
                'full_description': 'Descri√ß√£o Completa',
                'name': 'Nome',
                'behavior': 'Comportamento',
                'feature': 'Caracter√≠stica',
                'danger': 'Perigo',
                'atmosphere': 'Atmosfera',
                'motivation': 'Motiva√ß√£o',
                'demeanor': 'Comportamento',
                'origin': 'Origem',
                'weather': 'Clima',
                'innkeeper': 'Taverneiro',
                'effect': 'Efeito',
                'builder': 'Construtor',
                'age': 'Idade',
                'population': 'Popula√ß√£o',
                'trend': 'Tend√™ncia',
                'government': 'Governo',
                
                # Settlement Field Labels
                'local_tavern': 'Taberna Local',
                'local_power': 'Poder Local',
                'city_event': 'Evento da Cidade',
                'settlement_layout': 'Layout do Assentamento',
                'key_npcs': 'NPCs Principais',
                
                # City Overlay Field Labels
                'district': 'Distrito',
                'position': 'Posi√ß√£o',
                'random_encounters': 'Encontros Aleat√≥rios',
                'notable_features': 'Caracter√≠sticas Not√°veis',
                'encounter': 'Encontro'
            }
        }
    
    def t(self, key: str, **kwargs) -> str:
        """Translate a key to the current language with optional formatting."""
        translation = self.translations.get(self.language, {}).get(key, key)
        
        # Apply formatting if kwargs provided
        if kwargs:
            try:
                translation = translation.format(**kwargs)
            except (KeyError, ValueError):
                # If formatting fails, return the key
                return key
        
        return translation
    
    def set_language(self, language: str):
        """Set the current language."""
        if language in self.translations:
            self.language = language
        else:
            print(f"‚ö†Ô∏è  Language '{language}' not supported, using 'en'")
            self.language = 'en'
    
    def get_supported_languages(self) -> List[str]:
        """Get list of supported languages."""
        return list(self.translations.keys())
    
    def get_current_language(self) -> str:
        """Get the current language."""
        return self.language
    
    def has_translation(self, key: str) -> bool:
        """Check if a translation key exists for the current language."""
        return key in self.translations.get(self.language, {})
    
    def get_all_translations(self, key: str) -> Dict[str, str]:
        """Get all translations for a key across all languages."""
        return {
            lang: translations.get(key, key)
            for lang, translations in self.translations.items()
        }

# Global translation system instance
translation_system = TranslationSystem() 